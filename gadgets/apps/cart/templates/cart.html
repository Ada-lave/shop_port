{% extends 'base.html' %}
{% block title %}Cart{% endblock %}


{% block content %}
<div id="cartapp">
    <h1 class="title">Cart</h1>
    {% if cart %}
    <div class="table">
        <table class="table">
            <thead>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th></th>
            </thead>
            <tbody>
                {% for item in cart %}
            {% with product=item.product %}
                <tr>
                    <td>{{product.title}}</td>
                    <td>{{ item.quantity }} </td>
                    <td>{{ item.total_price }}</td>

                    <td><button v-on:click="RemoveProduct({{ product.id }})">Delete</button></td>
                </tr>
                
            {% endwith %}
        {% endfor %}
            </tbody>
        </table>
    </div>
        

    {% else %}
        <p>Cart is empty</p>
    {% endif %}
</div>
{% endblock %}


{% block scripts %}
<script>
    var productapp = new Vue({
        el:'#cartapp',
        delimeters: ['[[',']]'],
        data() {
            return {

            }
        },

        mounted() {
            console.log('Mounted')
        },
        methods: {
            incrementQuantity(prod_id) {
            

                var data = {'product_id':prod_id, 'update':true, 'quantity':1}

                fetch('/api/AddToCard/',{
                    method: 'POST',
                    headers: {
                        'Content-Type':'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(data)
                })
                .then((response) => {
                    console.log(response)
                })
                
                .catch(function error(){
                    console.log('Error 2')
                })
            },
            RemoveProduct(prod_id){
                console.log(prod_id)

                var data = {'product_id':prod_id}

                fetch('/api/RemoveCart/',{
                    method: 'POST',
                    headers: {
                        'Content-Type':'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(data)
                })
                .then((response) => {
                    console.log(response)
                })
                
                .catch(function error(){
                    console.log('Error 2')
                })
            }
        },
    })
</script>
{% endblock %}